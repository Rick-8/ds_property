{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="card shadow">
        <div class="card-header bg-dark text-white text-center">
          <h3>{{ user.username }} Profile</h3>
        </div>
        <div class="card-body">
          <form method="POST" enctype="multipart/form-data" class="row g-3">
            {% csrf_token %}

            <!-- Contact Info Section -->
            <div class="card mb-4 w-100">
              <div class="card-header bg-secondary text-white">
                Contact Information
              </div>
              <div class="card-body row g-3">
                <div class="col-12 col-md-6">
                  <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
                  {{ form.email|add_class:"form-control" }}
                  {% if form.email.errors %}
                  <div class="text-danger small">{{ form.email.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-6">
                  <label for="{{ form.phone.id_for_label }}" class="form-label">Phone</label>
                  {{ form.phone|add_class:"form-control" }}
                  {% if form.phone.errors %}
                  <div class="text-danger small">{{ form.phone.errors|striptags }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Company Info Section -->
            <div class="card mb-4 w-100">
              <div class="card-header bg-secondary text-white">
                Company Information
              </div>
              <div class="card-body row g-3">
                <div class="col-12 col-md-6">
                  <label for="{{ form.company_name.id_for_label }}" class="form-label">Company Name</label>
                  {{ form.company_name|add_class:"form-control" }}
                  {% if form.company_name.errors %}
                  <div class="text-danger small">{{ form.company_name.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-6">
                  <label for="{{ form.vat_number.id_for_label }}" class="form-label">VAT Number</label>
                  {{ form.vat_number|add_class:"form-control" }}
                  {% if form.vat_number.errors %}
                  <div class="text-danger small">{{ form.vat_number.errors|striptags }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Address Section -->
            <div class="card mb-4 w-100">
              <div class="card-header bg-secondary text-white">
                Address
              </div>
              <div class="card-body row g-3">
                <div class="col-12">
                  <label for="{{ form.default_address_line_1.id_for_label }}" class="form-label">Address Line 1</label>
                  {{ form.default_address_line_1|add_class:"form-control" }}
                  {% if form.default_address_line_1.errors %}
                  <div class="text-danger small">{{ form.default_address_line_1.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12">
                  <label for="{{ form.default_address_line_2.id_for_label }}" class="form-label">Address Line 2</label>
                  {{ form.default_address_line_2|add_class:"form-control" }}
                  {% if form.default_address_line_2.errors %}
                  <div class="text-danger small">{{ form.default_address_line_2.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-4">
                  <label for="{{ form.default_city.id_for_label }}" class="form-label">City</label>
                  {{ form.default_city|add_class:"form-control" }}
                  {% if form.default_city.errors %}
                  <div class="text-danger small">{{ form.default_city.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-4">
                  <label for="{{ form.default_postcode.id_for_label }}" class="form-label">Postcode</label>
                  {{ form.default_postcode|add_class:"form-control" }}
                  {% if form.default_postcode.errors %}
                  <div class="text-danger small">{{ form.default_postcode.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-4">
                  <label for="{{ form.default_country.id_for_label }}" class="form-label">Country</label>
                  {{ form.default_country|add_class:"form-control" }}
                  {% if form.default_country.errors %}
                  <div class="text-danger small">{{ form.default_country.errors|striptags }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Preferences Section -->
            <div class="card mb-4 w-100">
              <div class="card-header bg-secondary text-white">
                Preferences
              </div>
              <div class="card-body row g-3">
                <div class="col-12 col-md-6">
                  <label for="{{ form.preferred_contact_time.id_for_label }}" class="form-label">Preferred Contact
                    Time</label>
                  {{ form.preferred_contact_time|add_class:"form-control" }}
                  {% if form.preferred_contact_time.errors %}
                  <div class="text-danger small">{{ form.preferred_contact_time.errors|striptags }}</div>
                  {% endif %}
                </div>

                <div class="col-12 col-md-6">
                  <label for="{{ form.timezone.id_for_label }}" class="form-label">Timezone</label>
                  {{ form.timezone|add_class:"form-control" }}
                  {% if form.timezone.errors %}
                  <div class="text-danger small">{{ form.timezone.errors|striptags }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Add to Property List Toggle Switch with Tooltip -->
            <div class="col-12 mb-4">
              <div class="form-check form-switch" data-bs-toggle="tooltip" data-bs-placement="right"
                title="Check this if you'd like to save this address as a property">
                {{ form.add_as_property|add_class:"form-check-input" }}
                <label class="form-check-label" for="{{ form.add_as_property.id_for_label }}">
                  Add this address to my property list
                </label>
              </div>
              {% if form.add_as_property.errors %}
              <div class="text-danger small">{{ form.add_as_property.errors|striptags }}</div>
              {% endif %}

            </div>

            <!-- Notes Section (full width) -->
            <div class="col-12 mb-4">
              {{ form.media }}
              <label for="{{ form.notes.id_for_label }}" class="form-label">Notes</label>
              {{ form.notes|add_class:"form-control" }}
              {% if form.notes.errors %}
              <div class="text-danger small">{{ form.notes.errors|striptags }}</div>
              {% endif %}
            </div>

            <!-- Submit Button - centered -->
            <div class="col-12 text-center mt-3">
              <button class="btn btn-dark rounded-pill px-4 py-2" type="submit">Save Profile</button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% for agreement in agreements %}
  <div>
    <strong>Package:</strong> {{ agreement.service_package.name }}<br>
    <strong>Property:</strong> {{ agreement.property.label }} - {{ agreement.property.address_line_1 }}<br>
    <strong>Billing Address:</strong> {{ agreement.billing_address.address_line_1 }}, {{ agreement.billing_address.city }}
  </div>
{% empty %}
  <p>No active service agreements.</p>
{% endfor %}

<!-- Bootstrap Tooltip Initialization -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
      new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>
{% endblock %}