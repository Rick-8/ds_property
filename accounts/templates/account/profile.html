{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-9">
      <div class="card shadow-lg dark-opaque text-light border-0 rounded-4">
        <div class="card-header bg-black text-gold text-center rounded-top-4">
          <h3 class="mb-0" style="letter-spacing: 1px;">{{ user.username }}'s Profile</h3>
        </div>
        <div class="card-body px-3 px-md-5 py-4">
          <form method="POST" enctype="multipart/form-data" class="row g-4">
            {% csrf_token %}

            <!-- Contact Info Section -->
            <div class="col-12">
              <div class="border rounded-3 mb-4 bg-gradient-dark">
                <div class="bg-gold bg-opacity-25 py-2 px-3 rounded-top-3">
                  <span class="fw-bold text-gold">Contact Information</span>
                </div>
                <div class="row g-3 py-3 px-2 px-md-3">
                  <div class="col-12 col-md-6">
                    <label for="{{ form.email.id_for_label }}" class="form-label text-gold">Email</label>
                    {{ form.email|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.email.errors %}
                    <div class="text-danger small">{{ form.email.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="{{ form.phone.id_for_label }}" class="form-label text-gold">Phone</label>
                    {{ form.phone|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.phone.errors %}
                    <div class="text-danger small">{{ form.phone.errors|striptags }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Company Info Section -->
            <div class="col-12">
              <div class="border rounded-3 mb-4 bg-gradient-dark">
                <div class="bg-gold bg-opacity-25 py-2 px-3 rounded-top-3">
                  <span class="fw-bold text-gold">Company Information</span>
                </div>
                <div class="row g-3 py-3 px-2 px-md-3">
                  <div class="col-12 col-md-6">
                    <label for="{{ form.company_name.id_for_label }}" class="form-label text-gold">Company Name</label>
                    {{ form.company_name|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.company_name.errors %}
                    <div class="text-danger small">{{ form.company_name.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="{{ form.vat_number.id_for_label }}" class="form-label text-gold">VAT Number</label>
                    {{ form.vat_number|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.vat_number.errors %}
                    <div class="text-danger small">{{ form.vat_number.errors|striptags }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Address Section -->
            <div class="col-12">
              <div class="border rounded-3 mb-4 bg-gradient-dark">
                <div class="bg-gold bg-opacity-25 py-2 px-3 rounded-top-3">
                  <span class="fw-bold text-gold">Address</span>
                </div>
                <div class="row g-3 py-3 px-2 px-md-3">
                  <div class="col-12">
                    <label for="{{ form.default_address_line_1.id_for_label }}" class="form-label text-gold">Address
                      Line 1</label>
                    {{ form.default_address_line_1|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.default_address_line_1.errors %}
                    <div class="text-danger small">{{ form.default_address_line_1.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12">
                    <label for="{{ form.default_address_line_2.id_for_label }}" class="form-label text-gold">Address
                      Line 2</label>
                    {{ form.default_address_line_2|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.default_address_line_2.errors %}
                    <div class="text-danger small">{{ form.default_address_line_2.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12 col-md-4">
                    <label for="{{ form.default_city.id_for_label }}" class="form-label text-gold">City</label>
                    {{ form.default_city|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.default_city.errors %}
                    <div class="text-danger small">{{ form.default_city.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12 col-md-4">
                    <label for="{{ form.default_postcode.id_for_label }}" class="form-label text-gold">Postcode</label>
                    {{ form.default_postcode|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.default_postcode.errors %}
                    <div class="text-danger small">{{ form.default_postcode.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12 col-md-4">
                    <label for="{{ form.default_country.id_for_label }}" class="form-label text-gold">Country</label>
                    {{ form.default_country|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.default_country.errors %}
                    <div class="text-danger small">{{ form.default_country.errors|striptags }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <!-- Preferences Section -->
            <div class="col-12">
              <div class="border rounded-3 mb-4 bg-gradient-dark">
                <div class="bg-gold bg-opacity-25 py-2 px-3 rounded-top-3">
                  <span class="fw-bold text-gold">Preferences</span>
                </div>
                <div class="row g-3 py-3 px-2 px-md-3">
                  <div class="col-12 col-md-6">
                    <label for="{{ form.preferred_contact_time.id_for_label }}" class="form-label text-gold">Preferred
                      Contact Time</label>
                    {{ form.preferred_contact_time|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.preferred_contact_time.errors %}
                    <div class="text-danger small">{{ form.preferred_contact_time.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="{{ form.timezone.id_for_label }}" class="form-label text-gold">Timezone</label>
                    {{ form.timezone|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.timezone.errors %}
                    <div class="text-danger small">{{ form.timezone.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <!-- Marketing Consent Checkbox -->
                  <div class="col-12">
                    <div class="form-check d-flex align-items-center mb-3">
                      {{ form.marketing_consent|add_class:"form-check-input bg-gold border-gold me-2" }}
                      <label class="form-check-label text-gold" for="{{ form.marketing_consent.id_for_label }}">
                        <i class="bi bi-envelope-paper me-1"></i>
                        I would like to receive news, offers, and updates by email from DS Property Maintenance.
                      </label>
                    </div>
                    {% if form.marketing_consent.errors %}
                    <div class="text-danger small">{{ form.marketing_consent.errors|striptags }}</div>
                    {% endif %}
                  </div>

                  <!-- Add to Property List Toggle Switch -->
                  <div class="col-12">
                    <div class="form-check form-switch d-flex align-items-center mb-3">
                      {{ form.add_as_property|add_class:"form-check-input border-gold me-2" }}
                      <label class="form-check-label text-gold" for="{{ form.add_as_property.id_for_label }}">
                        <i class="bi bi-bookmark-plus me-1"></i>
                        Add this address to my property list
                      </label>
                    </div>
                    {% if form.add_as_property.errors %}
                    <div class="text-danger small">{{ form.add_as_property.errors|striptags }}</div>
                    {% endif %}
                  </div>
                  <!-- Notes Section (full width) -->
                  <div class="col-12 mb-4">
                    {{ form.media }}
                    <label for="{{ form.notes.id_for_label }}" class="form-label text-gold">Notes</label>
                    <br>
                    {{ form.notes|add_class:"form-control bg-dark border-gold text-light" }}
                    {% if form.notes.errors %}
                    <div class="text-danger small">{{ form.notes.errors|striptags }}</div>
                    {% endif %}
                  </div>

                  <!-- Submit Button - centered -->
                  <div class="col-12 text-center mt-3">
                    <button class="btn btn-glass-gold btn-lg rounded-pill px-5 py-2" type="submit">
                      <i class="bi bi-save me-2"></i>Save Profile
                    </button>
                  </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% for agreement in agreements %}
<div class="my-3 p-3 border rounded dark-opaque bg-opacity-75 text-light">
  <strong>Package:</strong> <span class="text-gold">{{ agreement.service_package.name }}</span><br>
  <strong>Property:</strong> {{ agreement.property.label }} - {{ agreement.property.address_line_1 }}<br>
  <strong>Billing Address:</strong> {{ agreement.billing_address.address_line_1 }}, {{ agreement.billing_address.city }}
</div>
{% empty %}
<p class="text-center dark-opaque text-warning mt-5">No active service agreements.</p>
{% endfor %}

<!-- Bootstrap Tooltip Initialization -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
      new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>
{% endblock %}